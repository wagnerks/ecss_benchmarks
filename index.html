<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ecss vs entt Benchmarks</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #1e1e1e;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    .charts {
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* 2 графика в ряд */
      gap: 20px;
    }
    canvas {
      background: #2a2a2a;
      border-radius: 8px;
      padding: 10px;
      width: 100% !important;
      height: 300px !important; /* фиксированная высота графиков */
    }
    .toggle {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    button {
      padding: 10px 20px;
      background: #444;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #666;
    }
  </style>
</head>
<body>
  <h1>
    ecss vs entt Benchmarks  
    <a href="https://github.com/wagnerks/ecss" target="_blank" style="color:#4ea3ff">[ecss repo]</a>
  </h1>

  <div class="toggle">
    <button id="toggleScale">Switch to Linear Scale</button>
  </div>

  <div class="charts" id="charts"></div>

  <script>
    async function loadData() {
      const response = await fetch("results.json");
      const data = await response.json();
      return data.benchmarks;
    }

    function groupBenchmarks(benchmarks) {
      const groups = {};
      benchmarks.forEach(b => {
        const [lib, name] = b.name.split(".....................");
        const [test, count] = name.split("/");
        if (!groups[test]) groups[test] = {};
        if (!groups[test][count]) groups[test][count] = {};
        groups[test][count][lib] = b.cpu_time;
      });
      return groups;
    }

    function renderCharts(groups, scaleType = 'logarithmic') {
      const chartsDiv = document.getElementById("charts");
      chartsDiv.innerHTML = "";
      Object.keys(groups).forEach(test => {
        const ctx = document.createElement("canvas");
        chartsDiv.appendChild(ctx);

        const counts = Object.keys(groups[test]).sort((a,b) => +a - +b);
        const ecssData = counts.map(c => groups[test][c].ecss || null);
        const enttData = counts.map(c => groups[test][c].entt || null);

        new Chart(ctx, {
          type: "bar",
          data: {
            labels: counts,
            datasets: [
              { label: "ecss", data: ecssData, backgroundColor: "rgba(220,53,69,0.7)" },
              { label: "entt", data: enttData, backgroundColor: "rgba(40,167,69,0.7)" }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              title: { display: true, text: test, color: "#fff" },
              legend: { labels: { color: "#fff" } }
            },
            scales: {
              x: {
                title: { display: true, text: "Entities", color: "#fff" },
                ticks: { color: "#fff" },
                grid: { color: "rgba(255,255,255,0.05)" }
              },
              y: {
                type: scaleType,
                beginAtZero: true,
                title: { display: true, text: "Time (µs)", color: "#fff" },
                ticks: { color: "#fff" },
                grid: { color: "rgba(255,255,255,0.05)" }
              }
            }
          }
        });
      });
    }

    (async () => {
      const data = await loadData();
      const groups = groupBenchmarks(data);
      let currentScale = 'logarithmic';

      renderCharts(groups, currentScale);

      document.getElementById("toggleScale").addEventListener("click", () => {
        currentScale = currentScale === 'logarithmic' ? 'linear' : 'logarithmic';
        renderCharts(groups, currentScale);
        document.getElementById("toggleScale").innerText =
          currentScale === 'logarithmic' ? "Switch to Linear Scale" : "Switch to Log Scale";
      });
    })();
  </script>
</body>
</html>
